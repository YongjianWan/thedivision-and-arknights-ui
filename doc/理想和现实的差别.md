# 理想和现实的差别

> 依据 `doc/设定总纲1.md` + `doc/设定总纲2.md`，对当前工程实现做差距评估。

## 理想设定（摘要）
- 设计定律：系统感界面、三层信息、强调色只用于焦点/告警/关键读数、结构稳定、硬朗不软糯、炫但不吵。
- 视觉语法：L0-L3 边框层级、8pt 网格、模块化卡片、语义色限制、排版与数字优先。
- Token 规范：`tokens.json` 是唯一真源，其他格式需自动生成。
- 组件与动效：面板/按钮/列表行/输入/Toast/表格/Modal/Drawer/Tabs/Progress 等，动效短促、状态驱动、同时动效 <=2，背景动效可暂停。
- 状态与输入：状态优先级、互斥规则、最小命中区、焦点可见。

## 现有工程状态（事实）
- 技术栈：Next.js + Tailwind + Framer Motion，含 Three.js 粒子场 (`src/components/ParticleField.tsx`)。
- 组件已实现：Button、TacticalPanel、Select、Table、Tabs、Modal、Drawer、Tooltip、Card、Progress/Spinner、HUDMeter、StatusBar、Breadcrumb、Typewriter、GridBackground、ScanSweep 等（见 `src/components/*`）。
- 页面 Demo：Dashboard、Battle、Operator、Login、组件展示页（见 `src/app/*/page.tsx`）。
- 设计 Tokens：有 `tokens.json`，但 CSS 变量在 `src/app/globals.css` 手工维护，未见生成链路。
- 工程一致性风险：多处页面引用了不存在的 props/接口（例如 `GridBackground` 的 `variant/opacity`、`ScanSweep` 的 `color/interval`、`Tabs` 的 `onTabChange`、`HUDMeter` 的 `segments/color`、`Progress` 的 `color`），这些会造成类型/运行错误（见 `src/app/battle/page.tsx`、`src/app/operator/page.tsx`、`src/app/login/page.tsx`）。
- 编码/语法风险：部分中文字符串出现乱码与疑似 JSX/字符串断裂（例如 `src/app/battle/page.tsx`、`src/app/operator/page.tsx`），可能导致构建失败。

## 主要差距（理想 vs 现实）

### 1) Token 真源未落地
- 设定要求 `tokens.json` 为唯一真源，但目前 `globals.css` 与 `tokens.json` 并存且无生成流程（`tokens.json`，`src/app/globals.css`）。
- 现实中额外引入了 `accentAlt`/`invert` 等扩展色（`tokens.json`），设定中未定义，语义边界不清晰。
已修复：
- 引入 `src/app/tokens.css` 作为 token 输出，`src/app/globals.css` 改为 `@import` 该文件（`src/app/tokens.css`，`src/app/globals.css`）。
- 增加 `scripts/generate-tokens.mjs` 与 `tokens:build` 脚本，统一从 `tokens.json` 生成 CSS 变量（`scripts/generate-tokens.mjs`，`package.json`）。

### 2) 颜色与强调规范被稀释
- 强调色大量用于装饰性背景/几何元素（`src/components/GridBackground.tsx`、`src/app/layout.tsx`），违背“强调色只用于焦点/告警/关键读数”。
- 页面同时出现多种高饱和语义色（accent + warning + success + danger + accentAlt），超出“同一时刻最多 2 种高饱和色”的约束（如 `src/app/dashboard/page.tsx`、`src/app/components/page.tsx`）。

### 3) L0-L3 边框层级与 L3 数量约束未严格执行
- L3 强调容器在示例页中可同时出现多个，违反“同屏 L3 <= 1”（例如 `src/app/components/page.tsx`）。
- L3 使用范围未限定在焦点/告警模块，更多是视觉效果展示。

### 4) 8pt 网格约束执行不足
- 大量 12px/20px 等非 8 倍数布局间距（如 `p-3`、`gap-3` 等），与“布局间距必须为 8 倍数”冲突（例如 `src/app/components/page.tsx`、`src/app/battle/page.tsx`）。

### 5) 动效系统规则未统一控制
- 背景动效常态运行且数量较多（GridBackground、scanline、雷达/粒子/角标等），不满足“同时动效 <=2、背景层安静”的基准（`src/components/GridBackground.tsx`、`src/app/layout.tsx`）。
- Modal/Drawer 打开时应冻结背景动效，但目前没有统一的暂停机制（`src/components/Modal.tsx`、`src/components/Drawer.tsx` 与 `src/components/GridBackground.tsx` 无联动）。
已修复：
- 通过 `body[data-overlay-open]` 统一暂停背景动效，并在 Modal/Drawer 打开时设置/清除该状态（`src/lib/overlay.ts`，`src/components/Modal.tsx`，`src/components/Drawer.tsx`，`src/app/globals.css`）。
- GridBackground 支持 `variant/opacity`，并对动效元素统一标记以便暂停（`src/components/GridBackground.tsx`，`src/app/globals.css`）。已修复：
- 通过 `body[data-overlay-open]` 统一暂停背景动效，并在 Modal/Drawer 打开时设置/清除该状态（`src/lib/overlay.ts`，`src/components/Modal.tsx`，`src/components/Drawer.tsx`，`src/app/globals.css`）。
- GridBackground 支持 `variant/opacity`，并对动效元素统一标记以便暂停（`src/components/GridBackground.tsx`，`src/app/globals.css`）。

### 6) 组件覆盖不完整
- 设定中的 ListRow、Toast、Tag/Badge、Divider、Input 等组件缺失或仅零散使用原生 input（`src/components` 目录）。
- 状态系统未形成统一抽象（loading/warn/error/critical 互斥规则与优先级未落地）。

### 7) 输入与焦点规范不一致
- 设定要求“焦点必须可见（形状/位置变化）”，但各组件焦点方式不统一（ring/边框/左侧线条混用）。
- 输入框缺少统一设计与状态处理（hover/focus/error/disabled 规则未形成组件级规范）。
已修复：
- 增加统一的 `.focus-ring` 样式并在登录页输入框应用（`src/app/globals.css`，`src/app/login/page.tsx`）。

### 8) 工程实现一致性不足
- 多处页面调用的组件 props 与实现不一致，导致无法真实验证规范（示例见 `src/app/battle/page.tsx`、`src/app/operator/page.tsx`、`src/app/login/page.tsx`）。
- 演示页更偏视觉探索而非“规范收敛”的可复用系统。
已修复：
- 补齐组件 API：`ScanSweep` 支持 `color/interval`，`Tabs` 支持 `onTabChange`，`HUDMeter` 支持 `segments/color`，`Progress` 支持 `color`，`TacticalPanel` 支持 `headerRight`，并添加 `MOTION.duration.normal`（`src/components/ScanSweep.tsx`，`src/components/Tabs.tsx`，`src/components/HUDMeter.tsx`，`src/components/Progress.tsx`，`src/components/TacticalPanel.tsx`，`src/lib/motion.ts`）。

## 结论
当前工程已经具备一批核心组件和演示页面，但更多处于“视觉原型 + 效果集合”的阶段。与设定总纲相比，最大差距集中在：
1) Token 真源与生成链路未落地；
2) 颜色/强调/动效的系统性约束未执行；
3) 组件覆盖与状态体系未闭环；
4) 工程一致性与可运行性存在明显断层。

若目标是把“设定总纲”落成工程规范，需要优先把 Token 链路、动效控制、组件缺口与类型一致性打通，再进行视觉细化。
