@import './tokens.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --bg-base-rgb: 7 10 14;
    --bg-elevated-rgb: 21 29 46;
    --border-strong-rgb: 58 74 90;
    --accent-rgb: 255 106 0;
    --accent-alt-rgb: 24 209 255;
  }

  body {
    @apply min-h-screen overflow-hidden antialiased;
    background-color: var(--bg-base);
    color: var(--text-primary);
    font-family: var(--font-sans);
  }

  ::selection {
    background-color: var(--accent);
    color: white;
  }
}

@layer components {
  .focus-ring {
    @apply focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-base)];
  }

  body[data-overlay-open="true"] .grid-scan,
  body[data-overlay-open="true"] .grid-particle {
    animation-play-state: paused;
  }

  body[data-overlay-open="true"] .grid-animated {
    opacity: 0.2;
  }

  .grid-scan {
    animation-name: grid-scan;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    will-change: transform;
  }

  .grid-particle {
    animation-name: grid-particle-fall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    will-change: transform, opacity;
  }

  .scanline-overlay {
    @apply fixed inset-0 pointer-events-none z-50 opacity-[0.03] overflow-hidden;
    background: 
      linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),
      linear-gradient(90deg, rgba(var(--accent-rgb),0.06), rgba(var(--accent-rgb),0.02), rgba(var(--accent-rgb),0.06));
    background-size: 100% 2px, 3px 100%;
  }

  .tactical-panel {
    border: 1px solid var(--border-weak);
    background-color: var(--bg-elevated);
    position: relative;
    overflow: hidden;
  }

  .border-l2 {
    border: 2px solid var(--border-strong);
    padding: 2px;
  }

  .border-l2-inner {
    border: 1px solid var(--border-weak);
    height: 100%;
    width: 100%;
  }

  .border-l3 {
    border: 2px solid var(--accent);
    padding: 2px;
  }

  /* Transition utilities */
  .transition-fast {
    transition-duration: var(--transition-fast);
  }
  .transition-base {
    transition-duration: var(--transition-base);
  }
  .transition-slow {
    transition-duration: var(--transition-slow);
  }

  /* Glow effects */
  .glow-accent {
    box-shadow: 0 0 20px rgba(var(--accent-rgb) / 0.4);
  }
  .glow-accent-alt {
    box-shadow: 0 0 20px rgba(var(--accent-alt-rgb) / 0.4);
  }

  /* Backdrop blur (for modals/overlays) */
  .backdrop-blur-panel {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Clipped corners (Arknights signature style) */
  .clip-corner-tr {
    clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 0 100%);
  }
  .clip-corner-br {
    clip-path: polygon(0 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%);
  }
  .clip-corner-both {
    clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%);
  }

  /* Tech border glow animation */
  @keyframes border-glow {
    0%, 100% { box-shadow: 0 0 8px rgba(var(--accent-alt-rgb) / 0.3); }
    50% { box-shadow: 0 0 20px rgba(var(--accent-alt-rgb) / 0.6); }
  }
  .border-glow-pulse {
    animation: border-glow 2s ease-in-out infinite;
  }

  /* === HUD 数字字体 === */
  .font-hud {
    font-family: var(--font-hud), 'Orbitron', monospace;
  }
  .font-tactical {
    font-family: var(--font-tactical), 'Rajdhani', sans-serif;
  }

  .clip-chevron {
    clip-path: polygon(
      0 0, calc(100% - 16px) 0, 100% 50%, calc(100% - 16px) 100%, 0 100%
    );
  }

  /* === 边框扫描动画 === */
  .border-scan {
    position: relative;
    overflow: hidden;
  }
  .border-scan::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent-alt), transparent);
    animation: border-scan-h 3s linear infinite;
  }
  .border-scan::after {
    content: '';
    position: absolute;
    top: -100%;
    right: 0;
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, transparent, var(--accent-alt), transparent);
    animation: border-scan-v 3s linear infinite;
    animation-delay: 1.5s;
  }
  @keyframes border-scan-h {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
  }
  @keyframes border-scan-v {
    0% { top: -100%; }
    50%, 100% { top: 100%; }
  }

  /* 静态噪点叠加 */
  .noise-overlay {
    position: relative;
  }
  .noise-overlay::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.03;
    pointer-events: none;
    z-index: 1;
  }

  .soft-glitch {
    position: relative;
    display: inline-block;
  }
  .soft-glitch::before,
  .soft-glitch::after {
    content: attr(data-text);
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0.6;
    pointer-events: none;
  }
  .soft-glitch::before {
    color: var(--accent-alt);
    animation: soft-glitch-a var(--motion-glitch-duration, 100ms) ease-in-out infinite;
  }
  .soft-glitch::after {
    color: var(--accent);
    animation: soft-glitch-b var(--motion-glitch-duration, 100ms) ease-in-out infinite;
  }

  /* === P1: Ghost Layer System (幽灵层系统) === */
  .ghost-text {
    position: relative;
    isolation: isolate;
  }
  .ghost-text::before {
    content: attr(data-text);
    position: absolute;
    top: 2px;
    left: 0;
    color: #000;
    opacity: 0.3;
    filter: blur(3px);
    z-index: -2;
    pointer-events: none;
  }
  .ghost-text::after {
    content: attr(data-text);
    position: absolute;
    top: -2px;
    left: 1px;
    color: var(--accent);
    opacity: 0.1;
    filter: blur(5px);
    z-index: -1;
    pointer-events: none;
  }

  /* Ghost Layer - 用于面板标题 (继承当前文字颜色) */
  .ghost-title {
    position: relative;
    isolation: isolate;
  }
  .ghost-title::before {
    content: attr(data-text);
    position: absolute;
    top: 2px;
    left: 0;
    color: #000;
    opacity: 0.25;
    filter: blur(2px);
    z-index: -2;
    pointer-events: none;
  }
  .ghost-title::after {
    content: attr(data-text);
    position: absolute;
    top: -1px;
    left: 1px;
    color: var(--accent);
    opacity: 0.08;
    filter: blur(4px);
    z-index: -1;
    pointer-events: none;
  }

  /* === P4: Global Noise Overlay (全局噪点层) === */
  .noise-global {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9999;
    opacity: 0.03;
    mix-blend-mode: overlay;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='matrix' values='1 0 0 0 0.96 0 1 0 0 1 0 0 1 0 1 0 0 0 1 0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  /* === P3: Anchor Points (锚点系统) === */
  .anchor {
    position: absolute;
    width: 3px;
    height: 3px;
    background: var(--border-strong);
  }
  .anchor-tl { top: 4px; left: 4px; }
  .anchor-tr { top: 4px; right: 4px; }
  .anchor-bl { bottom: 4px; left: 4px; }
  .anchor-br { bottom: 4px; right: 4px; }

  /* L3 焦点态锚点 */
  .anchor-accent {
    width: 4px;
    height: 4px;
    background: var(--accent);
    animation: anchor-appear 150ms ease-out;
  }

  @keyframes anchor-appear {
    from { transform: scale(0); }
    to { transform: scale(1); }
  }

  /* === P9: Quantized Progress (量化进度条) === */
  .progress-quantized {
    transition: width 300ms steps(8);
  }
  .progress-smooth {
    transition: width 320ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* === P3: 受控故障效果 (Controlled Glitch) === */
  
  /* 容器抖动 - 轻度 */
  .glitch-active.glitch-light {
    animation: glitch-shake-light 50ms steps(2) 2;
  }
  
  /* 容器抖动 - 中度 */
  .glitch-active.glitch-medium {
    animation: glitch-shake-medium 60ms steps(3) 3;
  }
  
  /* 容器抖动 - 重度 */
  .glitch-active.glitch-heavy {
    animation: glitch-shake-heavy 80ms steps(4) 4;
  }

  @keyframes glitch-shake-light {
    0%, 100% { transform: translate(0); }
    50% { transform: translate(-1px, 1px); }
  }

  @keyframes glitch-shake-medium {
    0%, 100% { transform: translate(0); }
    25% { transform: translate(-2px, 1px); }
    50% { transform: translate(2px, -1px); }
    75% { transform: translate(-1px, -1px); }
  }

  @keyframes glitch-shake-heavy {
    0%, 100% { transform: translate(0); }
    20% { transform: translate(-3px, 2px); }
    40% { transform: translate(3px, -2px); }
    60% { transform: translate(-2px, -1px); }
    80% { transform: translate(2px, 1px); }
  }

  /* 文字色差效果 - 轻度 */
  .glitch-text-active.glitch-text-light {
    animation: glitch-text-light 100ms steps(2) 1;
  }

  /* 文字色差效果 - 中度 */
  .glitch-text-active.glitch-text-medium {
    animation: glitch-text-medium 150ms steps(3) 1;
  }

  /* 文字色差效果 - 重度 */
  .glitch-text-active.glitch-text-heavy {
    animation: glitch-text-heavy 200ms steps(4) 2;
  }

  @keyframes glitch-text-light {
    0%, 100% { 
      text-shadow: none;
      transform: translate(0);
    }
    50% { 
      text-shadow: 
        -1px 0 var(--danger),
        1px 0 cyan;
      transform: translate(1px, 0);
    }
  }

  @keyframes glitch-text-medium {
    0%, 100% { 
      text-shadow: none;
      transform: translate(0);
    }
    33% { 
      text-shadow: 
        -2px 0 var(--danger),
        2px 0 cyan;
      transform: translate(-1px, 0);
    }
    66% { 
      text-shadow: 
        2px 0 var(--danger),
        -2px 0 cyan;
      transform: translate(1px, 0);
    }
  }

  @keyframes glitch-text-heavy {
    0%, 100% { 
      text-shadow: none;
      transform: translate(0);
    }
    25% { 
      text-shadow: 
        -3px 0 var(--danger),
        3px 0 cyan;
      transform: translate(-2px, 1px);
    }
    50% { 
      text-shadow: 
        3px 0 var(--danger),
        -3px 0 cyan;
      transform: translate(2px, -1px);
    }
    75% { 
      text-shadow: 
        -2px 0 var(--danger),
        2px 0 cyan;
      transform: translate(-1px, 0);
    }
  }

  /* === P6: 量化缓动扩展 === */
  
  /* 数字滚动 - 跳变而非流动 */
  .number-tick {
    transition: transform 0.3s steps(5);
  }

  /* 透明度变化 - 模拟信号传输 */
  .fade-quantized {
    transition: opacity 0.2s steps(4);
  }

  /* HUDMeter 数值更新闪烁 */
  .hud-value-update {
    animation: value-flash 0.3s steps(3);
  }

  @keyframes value-flash {
    0%, 100% { opacity: 1; }
    33% { opacity: 0.6; }
    66% { opacity: 0.85; }
  }

  /* Skeleton 呼吸 - 量化版 */
  .skeleton-pulse-quantized {
    animation: skeleton-quantized 1.5s steps(8) infinite;
  }

  @keyframes skeleton-quantized {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
  }

  /* 位置变化 - 量化 */
  .translate-quantized {
    transition: transform 0.25s steps(6);
  }

  /* 尺寸变化 - 量化 */
  .scale-quantized {
    transition: transform 0.2s steps(4);
  }
}

@keyframes grid-scan {
  0% {
    transform: translateY(-5%);
  }
  100% {
    transform: translateY(105%);
  }
}

@keyframes grid-particle-fall {
  0% {
    transform: translateY(-10%);
    opacity: 0;
  }
  20% {
    opacity: 0.6;
  }
  80% {
    opacity: 0.6;
  }
  100% {
    transform: translateY(110%);
    opacity: 0;
  }
}

@keyframes soft-glitch-a {
  0%, 100% { transform: translate(0, 0); opacity: 0.5; }
  50% { transform: translate(calc(var(--motion-glitch-offset, 2px) * -1), 0); opacity: 0.25; }
}

@keyframes soft-glitch-b {
  0%, 100% { transform: translate(0, 0); opacity: 0.5; }
  50% { transform: translate(var(--motion-glitch-offset, 2px), 0); opacity: 0.25; }
}
